<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Marp PWA - Markdown to Slide Converter</title>
  <link rel="manifest" href="manifest_fixed.json">
  <link rel="stylesheet" href="style.css">
  <!-- CodeMirror CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/default.min.css">
</head>
<body>
  <!-- ローディング画面 -->
  <div id="loading" class="loading" style="display:none;">
    <div class="loading-spinner"></div>
    <div>処理中...</div>
  </div>
  <!-- エラー表示 -->
  <div id="error-display" class="error-display" style="display:none;">
    <div class="error-content">
      <h2>⚠️ エラーが発生しました</h2>
      <div id="error-message"></div>
      <button id="error-close" class="btn btn--primary">閉じる</button>
    </div>
  </div>
  <!-- 成功メッセージ -->
  <div id="success-display" class="status-message status-message--success" style="display:none;">
    <span id="success-message"></span>
    <button id="success-close" class="btn btn--sm">×</button>
  </div>
  <!-- メインアプリ -->
  <div class="app">
    <header class="app-header">
      <div class="header-content">
        <span class="app-title">Marp PWA - Markdown to Slide Converter</span>
        <div class="header-actions">
          <button id="save-md-btn" class="btn btn--outline" title="Markdownをダウンロード">💾 保存</button>
          <button id="export-pdf" class="btn btn--outline" title="PDF出力">📄 PDF</button>
          <button id="export-pptx" class="btn btn--outline" title="PPTX出力">📊 PPTX</button>
          <button id="export-html" class="btn btn--outline" title="HTML出力">🌐 HTML</button>
          <button id="settings-btn" class="btn btn--outline" title="設定">⚙️ 設定</button>
          <button id="preview-toggle" class="btn btn--outline" title="プレビュー切替">🖥️/📄</button>
        </div>
      </div>
    </header>
    <main class="app-main">
      <section class="editor-panel">
        <div class="panel-header">
          <h2>Markdown入力</h2>
          <div class="editor-status">
            <span id="char-count">0 文字</span>
            <span id="save-status">未保存</span>
          </div>
        </div>
        <div class="editor-container">
          <textarea id="markdown-editor" class="form-control" spellcheck="false"></textarea>
        </div>
      </section>
      <section class="preview-panel">
        <div class="panel-header">
          <h2 id="preview-title">リアルタイムプレビュー</h2>
          <div class="preview-controls">
            <button id="prev-slide" class="btn btn--sm" title="前のスライド">◀</button>
            <span id="slide-counter">1 / 1</span>
            <button id="next-slide" class="btn btn--sm" title="次のスライド">▶</button>
          </div>
        </div>
        <div class="preview-container">
          <div id="preview-content" class="preview-content">
            <p>プレビューするMarkdownを入力してください</p>
          </div>
        </div>
      </section>
    </main>
    <!-- 設定パネル -->
    <div id="settings-panel" class="modal hidden">
      <div class="modal-content settings-content" onclick="event.stopPropagation();">
        <div class="modal-header">
          <h3>設定</h3>
          <button id="settings-close" class="btn btn--sm">×</button>
        </div>
        <div class="modal-body">
          <form id="settings-form">
            <div class="form-group">
              <label class="form-label" for="theme-select">テーマ</label>
              <select id="theme-select" class="form-control">
                <option value="default">Default</option>
                <option value="gaia">Gaia</option>
                <option value="uncover">Uncover</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">フォントサイズ</label>
              <div>
                <label><input type="radio" name="font-size" value="small" id="font-size-small"> 小</label>
                <label><input type="radio" name="font-size" value="medium" id="font-size-medium" checked> 中</label>
                <label><input type="radio" name="font-size" value="large" id="font-size-large"> 大</label>
                <label><input type="radio" name="font-size" value="custom" id="font-size-custom"> カスタム</label>
                <input type="number" id="custom-font-size" class="form-control" min="8" max="64" step="1" value="16" style="width:80px;display:inline-block;" disabled> <span>px</span>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label" for="slide-ratio-select">スライド比率</label>
              <select id="slide-ratio-select" class="form-control">
                <option value="16:9">16:9</option>
                <option value="4:3">4:3</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label" for="background-color">背景色</label>
              <input type="color" id="background-color" class="form-control" value="#ffffff">
            </div>
            <div class="form-group">
              <label class="form-label" for="text-color">文字色</label>
              <input type="color" id="text-color" class="form-control" value="#000000">
            </div>
            <div class="form-group" style="display:flex;gap:8px;">
              <button type="button" id="reset-settings" class="btn btn--secondary">リセット</button>
              <button type="button" id="apply-settings" class="btn btn--primary">適用</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- 設定パネルの背景クリックで閉じる -->
    <div class="settings-overlay modal hidden" id="settings-overlay"></div>
  </div>
  <!-- 必須ライブラリCDN -->
  <script src="https://cdn.jsdelivr.net/npm/@marp-team/marp-core@4/lib/browser.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/markdown/markdown.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
  <!-- アプリ本体 -->
  <script src="app_fixed.js"></script>
  <!-- Service Worker登録 -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('sw_fixed.js').then(function(reg) {
          console.log('Service Worker registered:', reg);
        }).catch(function(err) {
          console.warn('Service Worker registration failed:', err);
        });
      });
    }
  </script>
</body>
</html>
